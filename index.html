<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Planner RitualÃ­stico â€” GrimÃ³rio Completo</title>
    <link rel="manifest" href="manifest.json">
  <style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital@0;1&family=Great+Vibes&family=Cinzel:wght@400;600&family=UnifrakturCook:700&display=swap');

body{
  font-family:'Cinzel',serif;
  background:radial-gradient(circle at top,#6b003f,#3a0023,#1a0010);
  margin:0;padding:0;
  color:#f3e6c8;
}

body::before{
  content:'â˜¾ âœ¶ âš â˜¿ â™€ â™‚ âš— ğŸœƒ ğŸœ ğŸœ‚ ğŸœ„';
  position:fixed; inset:0;
  opacity:0.06; font-size:140px;
  display:flex; align-items:center; justify-content:center;
  pointer-events:none;
}

#overlay{position:fixed;inset:0;background:linear-gradient(135deg,#e7dff0,#cbb7d8);display:flex;align-items:center;justify-content:center}
#container{background:#2a0018;padding:24px;border-radius:18px;width:380px;border:2px solid #d4af37}

#capa,#planner,#prospera{display:none;padding:24px}

h2,h3{color:#d4af37;font-family:'UnifrakturCook','Great Vibes',cursive;font-size:32px}

button{margin-top:10px;background:linear-gradient(135deg,#3a001f,#6b0040);color:#f5e6b8;border:1px solid #d4af37;padding:8px 18px;border-radius:22px;cursor:pointer;font-family:'Cinzel',serif}
input,select,textarea{width:100%;margin-bottom:8px}

.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
.dia{background:#fdfaf6;min-height:140px;border-radius:12px;padding:8px;cursor:pointer;position:relative;color:#c2187a}
.dias-semana div{text-align:center;font-weight:bold}

.preview{font-size:11px;margin-top:6px;font-style:italic}
.estrela{position:absolute;bottom:6px;right:8px;font-size:14px}
.iconesTopo{position:absolute;top:6px;right:8px;display:flex;gap:4px}

.top-nav{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.legenda{font-size:12px;margin:8px 0;display:flex;gap:12px}
            @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital@0;1&family=Great+Vibes&family=Cinzel:wght@400;600&family=UnifrakturCook:700&display=swap');

body{
  font-family:'Cinzel',serif;
  background:radial-gradient(circle at top,#6b003f,#3a0023,#1a0010);
  margin:0;padding:0;
  color:#f3e6c8;
}

body::before{
  content:'â˜¾ âœ¶ âš â˜¿ â™€ â™‚ âš— ğŸœƒ ğŸœ ğŸœ‚ ğŸœ„';
  position:fixed;
  inset:0;
  opacity:0.05;
  font-size:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}

main{
  display:grid;
  grid-template-columns: 2.2fr 1fr;
  gap:24px;
  max-width:1200px;
  margin:40px auto;
  padding:0 16px;
}

section{
  background:#2a0018;
  padding:28px;
  border-radius:22px;
  box-shadow:0 0 40px rgba(0,0,0,.6), inset 0 0 30px rgba(212,175,55,.12);
  border:2px solid #d4af37;
}

h1,h2,h3{
  color:#d4af37;
  font-family:'UnifrakturCook','Great Vibes',cursive;
}

h1{font-size:44px;text-align:center}
h2{font-size:30px;margin-top:0}
h3{font-size:22px}

.texto{
  color:#6b2f8a;
  font-size:14.5px;
  line-height:1.7;
  text-align:justify;
}

.livro label{
  display:block;
  margin-top:14px;
  font-size:13px;
}

.livro input{
  width:100%;
  box-sizing:border-box;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid #d4af37;
  background:#f8f1e8;
  font-family:'Cinzel',serif;
}

.caixa{
  box-sizing:border-box;

  background:#f4e8f6;
  color:#3a0023;
  padding:18px;
  border-radius:16px;
  margin-top:18px;
}

.lateral{
  position:sticky;
  top:24px;
}

.lunar{
  background:#1f0012;
  border:2px dashed #d4af37;
  padding:20px;
  border-radius:18px;
  font-size:14px;
}

.lunar strong{color:#d4af37}

.tabela{width:100%;border-collapse:collapse;margin-top:10px}
.tabela th,.tabela td{border-bottom:1px solid #d4af37;padding:6px}
.tabela input{
  width:100%;
  box-sizing:border-box;
  border:none;
  background:transparent;
  font-family:'Cinzel',serif;
}
button{margin-top:8px;background:#6b003f;color:#f3e6c8;border:1px solid #d4af37;border-radius:10px;padding:6px 10px;cursor:pointer}
button.remover{background:#3a0023;color:#d4af37}


/* cÃ¡lculos mÃ¡gicos */
.total-secao{
  margin-top:10px;
  font-size:14px;
  color:#6b003f;
  font-weight:600;
}
.saldo{
  margin-top:20px;
  padding:14px;
  background:#f0dff0;
  border-radius:14px;
  color:#3a0023;
  font-weight:600;
}
.grafico{
  margin-top:20px;
  background:#1f0012;
  border:1px solid #d4af37;
  border-radius:16px;
  padding:14px;
  color:#d4af37;
  font-size:13px;
}
  </style>
</head>
<body>

<!-- FORMULÃRIO -->
<div id="overlay">
  <div id="container">
    <h3>IdentificaÃ§Ã£o da Bruxa</h3>
    <label>Nome</label><input id="nome">
    <label>Signo</label><select id="signo"><option>Ãries</option><option>Touro</option><option>GÃªmeos</option><option>CÃ¢ncer</option><option>LeÃ£o</option><option>Virgem</option><option>Libra</option><option>EscorpiÃ£o</option><option>SagitÃ¡rio</option><option>CapricÃ³rnio</option><option>AquÃ¡rio</option><option>Peixes</option></select>
    <label>Ano pessoal</label><select id="anoPessoal"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option></select>
    <label>Ciclo menstrual</label><input id="ciclo" type="date">
    <button id="salvar">Entrar</button>
  </div>
</div>

<!-- CAPA -->
<button id="btnInstalar" style="display:none">
  ğŸ“² Instalar GrimÃ³rio
</button>

<div id="capa">
  <h2>Bem-vinda ao GrimÃ³rio</h2>
  <p id="nomeCapa"></p>
  <button id="irPlanner">Planner Mensal</button>
  <button id="irProspera">Livro da Bruxa PrÃ³spera</button>
</div>

<!-- PLANNER -->
<div id="planner">
  <div class="top-nav"><button id="voltarCapa">âŸµ Capa</button></div>
  <h2 id="perfil"></h2>
  <div class="legenda">
    <span>ğŸŒ‘ğŸŒ’ğŸŒ•ğŸŒ˜ LunaÃ§Ã£o</span>
    <span>ğŸ”¥ SabÃ¡</span>
    <span>â³ Lua fora de curso</span>
  </div>
  <div id="mesTitulo"></div>
  <div style="display:flex;justify-content:space-between;margin:10px 0">
    <button id="mesAnterior">â—€</button>
    <button id="mesProximo">â–¶</button>
  </div>
  <div class="grid dias-semana"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>SÃ¡b</div></div>
  <div class="grid" id="grid"></div>
</div>

<!-- MODAL -->
<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center">
  <div style="background:#fdfaf4;padding:20px;border-radius:12px;width:380px">
    <h3 id="modalTitulo"></h3>
    <div id="oraculo" style="color:#c2187a;font-style:italic"></div>
    <div id="notasSalvas"></div>
    <input type="time" id="notaHora" />
    <textarea id="notaTexto" style="height:80px"></textarea>
    <button id="btnSalvarNota">Salvar nota</button>
    <button id="btnFechar">Fechar</button>
  </div>
</div>

<!-- BRUXA PRÃ“SPERA -->
<div id="prospera">
  <div class="top-nav"><button id="voltarCapa2">âŸµ Capa</button></div>
 <h1>ğŸ“– Livro da Bruxa PrÃ³spera</h1>

<main>

  <section class="livro">

    <h2>âœ¦ Fonte de AbundÃ¢ncia</h2>
    <div class="texto">Registre todos os ganhos que chegam atÃ© vocÃª atravÃ©s do seu trabalho, trocas, serviÃ§os ou vendas.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>Origem do ganho</th><th>Valor</th><th></th></tr></thead>
        <tbody id="abundancia"></tbody>
      </table>
      <button onclick="addLinha('abundancia','ganho')">+ adicionar ganho</button>
      <div class="total-secao">Total AbundÃ¢ncia: R$ <span id="total-abundancia">0</span></div>
    </div>

    <h2 style="margin-top:34px">âœ¦ Fluidez</h2>
    <div class="texto">Aqui vocÃª observa para onde sua energia financeira escoa â€” como vocÃª gasta, sustenta e nutre sua vida.</div>

    <h3>A) Sustento</h3><div class="texto">Despesas essenciais para sua sobrevivÃªncia material: moradia, contas, transporte, alimentaÃ§Ã£o.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="sustento"></tbody>
      </table>
      <button onclick="addLinha('sustento')">+ adicionar gasto</button>
    </div>

    <h3>B) Florescimento</h3><div class="texto">Gastos que ampliam prazer, aprendizado, descanso, cultura e bem-estar.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="florescimento"></tbody>
      </table>
      <button onclick="addLinha('florescimento')">+ adicionar gasto</button>
    </div>

    <h3>C) Centelha EnergÃ©tica</h3><div class="texto">Gastos inesperados ou emergenciais que exigem energia imediata.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="centelha"></tbody>
      </table>
      <button onclick="addLinha('centelha')">+ adicionar gasto</button>
    </div>

    <h2 style="margin-top:34px">âœ¦ ExpansÃ£o</h2>
    <div class="texto">Reservas voltadas a investimentos futuros, sonhos, avanÃ§os e projetos de longo prazo.</div>
    <div class="caixa">
      <label>Sementes de Prosperidade</label>
      <input placeholder="Valor reservado">
      <label>Sonho ou intenÃ§Ã£o</label>
      <input placeholder="Liberdade, descanso, projeto...">
    </div>

        <div id="totais">
        <div class="total-secao">Total Sustento: R$ <span id="total-sustento">0</span></div>
        <div class="total-secao">Total Florescimento: R$ <span id="total-florescimento">0</span></div>
        <div class="total-secao">Total Centelha: R$ <span id="total-centelha">0</span></div>
        <div class="saldo">Saldo EnergÃ©tico do MÃªs: R$ <span id="saldo">0</span></div>
      </div>

  </section>

  <aside class="lateral">
    <section class="lunar">
      <h3>ğŸŒ™ A Lua Observa Teu Ouro</h3>
      <p><strong>Lua Nova:</strong> planeje, defina metas, evite impulsos.</p>
      <p><strong>Lua Crescente:</strong> organize, negocie, expanda.</p>
      <p><strong>Lua Cheia:</strong> agradeÃ§a, observe excessos.</p>
      <p><strong>Lua Minguante:</strong> corte gastos e libere padrÃµes.</p>
      <div class="grafico" id="grafico">ğŸ“Š GrÃ¡fico Ritual: Fluidez x Lua<br>(ativaÃ§Ã£o simbÃ³lica)</div>
    </section>
  </aside>

</main>

<script>
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
    
function recalcular(){
  const categorias=['sustento','florescimento','centelha','abundancia'];
  let somaTotal=0;

  categorias.forEach(cat=>{
    let soma=0;
    document.querySelectorAll(`#${cat} input[type="number"]`).forEach(i=>{
      soma+=Number(i.value)||0;
    });
    if(document.getElementById(`total-${cat}`)){
      document.getElementById(`total-${cat}`).textContent=soma.toFixed(2);
    }
    somaTotal+=soma;
  });

  const totalAbundancia = Number(document.getElementById('total-abundancia').textContent)||0;
  document.getElementById('saldo').textContent=(totalAbundancia - somaTotal).toFixed(2);
}

function addLinha(id,tipo){
  const tbody = document.getElementById(id);
  if(!tbody) return;

  const tr = document.createElement('tr');

  const tdDesc = document.createElement('td');
  const inputDesc = document.createElement('input');
  inputDesc.placeholder = tipo==='ganho' ? 'Descreva o ganho' : 'Descreva o gasto';
  tdDesc.appendChild(inputDesc);

  const tdValor = document.createElement('td');
  const inputValor = document.createElement('input');
  inputValor.type = 'number';
  inputValor.placeholder = '0.00';
  inputValor.oninput = recalcular;
  tdValor.appendChild(inputValor);

  const tdAcao = document.createElement('td');
  const btnRemover = document.createElement('button');
  btnRemover.textContent = 'âœ–';
  btnRemover.className = 'remover';
  btnRemover.onclick = () => tr.remove();
  tdAcao.appendChild(btnRemover);

  tr.appendChild(tdDesc);
  tr.appendChild(tdValor);
  tr.appendChild(tdAcao);

  tbody.appendChild(tr);
}

// testes mÃ­nimos automÃ¡ticos
addLinha('sustento');
addLinha('abundancia','ganho');
addLinha('florescimento');
addLinha('centelha');
function load(k){const v=localStorage.getItem(k);return v?JSON.parse(v):null}

const overlay=document.getElementById('overlay');
const capa=document.getElementById('capa');
const planner=document.getElementById('planner');
const prospera=document.getElementById('prospera');
const grid=document.getElementById('grid');
const mesTitulo=document.getElementById('mesTitulo');
const perfilEl=document.getElementById('perfil');

let mesAtual=new Date().getMonth();
let anoAtual=2026;
let diaAtual=null;


// ===== Dados lunares (2026 completo) =====
const lunacoes2026={
  '2026-01-03':{fase:'Lua Cheia', signo:'CÃ¢ncer', icone:'ğŸŒ•'},
  '2026-01-10':{fase:'Lua Minguante', signo:'Libra', icone:'ğŸŒ˜'},
  '2026-01-18':{fase:'Lua Nova', signo:'CapricÃ³rnio', icone:'ğŸŒ‘'},
  '2026-01-26':{fase:'Lua Crescente', signo:'Touro', icone:'ğŸŒ’'},
  '2026-02-01':{fase:'Lua Cheia', signo:'LeÃ£o', icone:'ğŸŒ•'},
  '2026-02-09':{fase:'Lua Minguante', signo:'EscorpiÃ£o', icone:'ğŸŒ˜'},
  '2026-02-17':{fase:'Lua Nova', signo:'AquÃ¡rio', icone:'ğŸŒ‘'},
  '2026-02-24':{fase:'Lua Crescente', signo:'GÃªmeos', icone:'ğŸŒ’'},
  '2026-03-03':{fase:'Lua Cheia', signo:'Virgem', icone:'ğŸŒ•'},
  '2026-03-11':{fase:'Lua Minguante', signo:'SagitÃ¡rio', icone:'ğŸŒ˜'},
  '2026-03-18':{fase:'Lua Nova', signo:'Peixes', icone:'ğŸŒ‘'},
  '2026-03-25':{fase:'Lua Crescente', signo:'CÃ¢ncer', icone:'ğŸŒ’'},
  '2026-04-01':{fase:'Lua Cheia', signo:'Libra', icone:'ğŸŒ•'},
  '2026-04-10':{fase:'Lua Minguante', signo:'CapricÃ³rnio', icone:'ğŸŒ˜'},
  '2026-04-17':{fase:'Lua Nova', signo:'Ãries', icone:'ğŸŒ‘'},
  '2026-04-23':{fase:'Lua Crescente', signo:'LeÃ£o', icone:'ğŸŒ’'},
  '2026-05-01':{fase:'Lua Cheia', signo:'EscorpiÃ£o', icone:'ğŸŒ•'},
  '2026-05-09':{fase:'Lua Minguante', signo:'AquÃ¡rio', icone:'ğŸŒ˜'},
  '2026-05-16':{fase:'Lua Nova', signo:'Touro', icone:'ğŸŒ‘'},
  '2026-05-23':{fase:'Lua Crescente', signo:'Virgem', icone:'ğŸŒ’'},
  '2026-05-31':{fase:'Lua Cheia', signo:'SagitÃ¡rio', icone:'ğŸŒ•'},
  '2026-06-08':{fase:'Lua Minguante', signo:'Peixes', icone:'ğŸŒ˜'},
  '2026-06-14':{fase:'Lua Nova', signo:'GÃªmeos', icone:'ğŸŒ‘'},
  '2026-06-21':{fase:'Lua Crescente', signo:'Virgem', icone:'ğŸŒ’'},
  '2026-06-29':{fase:'Lua Cheia', signo:'CapricÃ³rnio', icone:'ğŸŒ•'},
  '2026-07-07':{fase:'Lua Minguante', signo:'Ãries', icone:'ğŸŒ˜'},
  '2026-07-14':{fase:'Lua Nova', signo:'CÃ¢ncer', icone:'ğŸŒ‘'},
  '2026-07-21':{fase:'Lua Crescente', signo:'EscorpiÃ£o', icone:'ğŸŒ’'},
  '2026-07-29':{fase:'Lua Cheia', signo:'AquÃ¡rio', icone:'ğŸŒ•'},
  '2026-08-05':{fase:'Lua Minguante', signo:'Touro', icone:'ğŸŒ˜'},
  '2026-08-12':{fase:'Lua Nova', signo:'LeÃ£o', icone:'ğŸŒ‘'},
  '2026-08-19':{fase:'Lua Crescente', signo:'EscorpiÃ£o', icone:'ğŸŒ’'},
  '2026-08-28':{fase:'Lua Cheia', signo:'Peixes', icone:'ğŸŒ•'},
  '2026-09-04':{fase:'Lua Minguante', signo:'GÃªmeos', icone:'ğŸŒ˜'},
  '2026-09-11':{fase:'Lua Nova', signo:'Virgem', icone:'ğŸŒ‘'},
  '2026-09-18':{fase:'Lua Crescente', signo:'SagitÃ¡rio', icone:'ğŸŒ’'},
  '2026-09-26':{fase:'Lua Cheia', signo:'Ãries', icone:'ğŸŒ•'},
  '2026-10-03':{fase:'Lua Minguante', signo:'CÃ¢ncer', icone:'ğŸŒ˜'},
  '2026-10-10':{fase:'Lua Nova', signo:'Libra', icone:'ğŸŒ‘'},
  '2026-10-18':{fase:'Lua Crescente', signo:'AquÃ¡rio', icone:'ğŸŒ’'},
  '2026-10-26':{fase:'Lua Cheia', signo:'Touro', icone:'ğŸŒ•'},
  '2026-11-01':{fase:'Lua Minguante', signo:'LeÃ£o', icone:'ğŸŒ˜'},
  '2026-11-09':{fase:'Lua Nova', signo:'EscorpiÃ£o', icone:'ğŸŒ‘'},
  '2026-11-17':{fase:'Lua Crescente', signo:'Peixes', icone:'ğŸŒ’'},
  '2026-11-24':{fase:'Lua Cheia', signo:'GÃªmeos', icone:'ğŸŒ•'},
  '2026-12-01':{fase:'Lua Minguante', signo:'Virgem', icone:'ğŸŒ˜'},
  '2026-12-08':{fase:'Lua Nova', signo:'SagitÃ¡rio', icone:'ğŸŒ‘'},
  '2026-12-17':{fase:'Lua Crescente', signo:'Peixes', icone:'ğŸŒ’'},
  '2026-12-23':{fase:'Lua Cheia', signo:'GÃªmeos', icone:'ğŸŒ•'},
  '2026-12-30':{fase:'Lua Minguante', signo:'Libra', icone:'ğŸŒ˜'}
};
const sabas={
  '2026-02-01':{nome:'Lughnasadh',descricao:'Assar pÃ£es e bolos de grÃ£os, expressar gratidÃ£o pela fartura, agradecer pelos frutos colhidos e realizar ritual de colheita e prosperidade.'},
  '2026-03-20':{nome:'Mabon',descricao:'Oferendas de maÃ§Ã£s e frutas da estaÃ§Ã£o, partilha de banquetes, agradecimento pela colheita e rituais de equilÃ­brio e gratidÃ£o.'},
  '2026-05-01':{nome:'Samhain',descricao:'Honrar ancestrais, limpar altares, queimar pedidos ou banimentos, praticar divinaÃ§Ã£o e introspecÃ§Ã£o profunda.'},
  '2026-06-21':{nome:'Yule',descricao:'Acender a tora de Yule ou velas, decorar com sÃ­mbolos de vida eterna, celebrar o renascimento do sol e trocar presentes simbÃ³licos.'},
  '2026-08-01':{nome:'Imbolc',descricao:'Acender velas em honra a BrÃ­gida, realizar limpezas energÃ©ticas, rituais de purificaÃ§Ã£o, proteÃ§Ã£o e preparaÃ§Ã£o para a luz.'},
  '2026-09-22':{nome:'Ostara',descricao:'Plantio de sementes fÃ­sicas ou simbÃ³licas, decoraÃ§Ã£o de ovos, rituais de fertilidade, renovaÃ§Ã£o e equilÃ­brio.'},
  '2026-10-31':{nome:'Beltane',descricao:'DanÃ§ar ao redor do mastro de maio, acender fogueiras de proteÃ§Ã£o, celebrar amor, prazer, uniÃ£o e fertilidade.'},
  '2026-12-21':{nome:'Litha',descricao:'Rituais ao ar livre para absorver energia solar, colheita de ervas, fogueiras, mÃºsica, danÃ§a e honra ao Ã¡pice da luz.'}
};
const luaForaDeCurso={
  '2026-01-02':'09:23â€“10:09',
  '2026-02-05':'14:10â€“15:02',
  '2026-03-07':'22:40â€“23:30',
  '2026-04-11':'06:15â€“07:01',
  '2026-05-04':'18:50â€“19:44',
  '2026-06-09':'03:12â€“04:00',
  '2026-07-12':'11:30â€“12:18',
  '2026-08-06':'20:05â€“21:00',
  '2026-09-10':'08:44â€“09:33',
  '2026-10-08':'16:10â€“17:02',
  '2026-11-09':'01:22â€“02:10',
  '2026-12-07':'13:40â€“14:28'
};

function criarPlanner(){
  grid.innerHTML='';
  const total=new Date(anoAtual,mesAtual+1,0).getDate();
  const inicio=new Date(anoAtual,mesAtual,1).getDay();
  mesTitulo.textContent=new Date(anoAtual,mesAtual).toLocaleString('pt-BR',{month:'long',year:'numeric'});

  for(let i=0;i<inicio;i++){const v=document.createElement('div');v.style.visibility='hidden';grid.appendChild(v);}

  const notas=load('notas')||{};

  for(let d=1;d<=total;d++){
    const dataISO=`${anoAtual}-${String(mesAtual+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const el=document.createElement('div');el.className='dia';

    let icones='';
    if(lunacoes2026[dataISO]) icones+=lunacoes2026[dataISO].icone;
    if(sabas[dataISO]) icones+='ğŸ”¥';
    if(luaForaDeCurso[dataISO]) icones+='â³';

    el.innerHTML=`<strong>${d}</strong>`+(icones?`<div class="iconesTopo">${icones}</div>`:'');

    if(Array.isArray(notas[dataISO]) && notas[dataISO].length){
      el.innerHTML+=`<span class="estrela">âœ¶</span>`;
      const p=document.createElement('div');p.className='preview';p.textContent=notas[dataISO][notas[dataISO].length-1].texto;el.appendChild(p);
    }

    el.addEventListener('click',()=>abrirModal(dataISO,d));
    grid.appendChild(el);
  }
}

// ===== OrÃ¡culo diÃ¡rio =====
function avaliarDia(dataISO){
  const perfil=load('perfil')||{};
  const lua=lunacoes2026[dataISO];

  let linha1='';
  if(lua){
    linha1=`<strong>${lua.fase} em ${lua.signo}:</strong> ${significadoLua(lua.fase, lua.signo)}`;
  } else {
    linha1='<strong>Lua em trÃ¢nsito:</strong> continuidade do ciclo lunar em andamento.';
  }

  const numero=perfil.ano||'';
  const linha2=`<strong>Energia do dia:</strong> ${energiaDoDia(lua?.fase, numero, perfil.ciclo)}`;

  const linha3=`<strong>Ritual sugerido:</strong> ${ritualDoDia(lua?.fase, lua?.signo, dataISO)}`;

  return `${linha1}<br><br>${linha2}<br><br>${linha3}`;
}

function significadoLua(fase, signo){
  return `${fase.toLowerCase()} filtrada pela energia de ${signo}, ativando temas simbÃ³licos do signo.`;
}

function energiaDoDia(fase, numero, ciclo){
  let base=fase||'fluxo contÃ­nuo';
  let n=numero?` alinhado ao nÃºmero pessoal ${numero}`:'';
  let c=ciclo?' com influÃªncia corporal ativa':'';
  return `movimento interno guiado pela ${base}${n}${c}.`;
}

function ritualDoDia(fase, signo, dataISO){
  if(sabas[dataISO]){
    return `celebraÃ§Ã£o de ${sabas[dataISO].nome}: ${sabas[dataISO].descricao}`;
  }
  if(fase==='Lua Cheia') return 'ritual de gratidÃ£o, escrita consciente e celebraÃ§Ã£o simbÃ³lica.';
  if(fase==='Lua Nova') return 'plantio de intenÃ§Ãµes, silÃªncio ritual e visualizaÃ§Ã£o.';
  if(fase==='Lua Crescente') return 'aÃ§Ãµes progressivas, fortalecimento de hÃ¡bitos e foco.';
  if(fase==='Lua Minguante') return 'limpeza energÃ©tica, desapego e descanso consciente.';
  return 'prÃ¡tica simples de autocuidado e observaÃ§Ã£o.';
}

function abrirModal(dataISO,dia){
  diaAtual=dataISO;
  modalTitulo.textContent=`Dia ${dia}`;
  oraculo.innerHTML=avaliarDia(dataISO);
  notasSalvas.innerHTML='';
  const notas=load('notas')||{};
  if(Array.isArray(notas[dataISO])){
    notas[dataISO].forEach(n=>{const p=document.createElement('p');p.textContent=`${n.hora||''} â€” ${n.texto}`;notasSalvas.appendChild(p);});
  }
  modal.style.display='flex';
}

function fecharModal(){modal.style.display='none';notaTexto.value='';notaHora.value='';}

function salvarNota(){
  if(!notaTexto.value.trim()) return;
  const notas=load('notas')||{};
  if(!Array.isArray(notas[diaAtual])) notas[diaAtual]=[];
  notas[diaAtual].push({hora:notaHora.value,texto:notaTexto.value});
  save('notas',notas);
  fecharModal();criarPlanner();
}

salvar.onclick = () => {
  const perfil = {
    nome: nome.value,
    signo: signo.value,
    ano: anoPessoal.value,
    ciclo: ciclo.value
  };

  save('perfil', perfil);
  solicitarNotificacao(); // aqui estÃ¡ correto
  nomeCapa.textContent = `Salve, ${perfil.nome}`;

  overlay.style.display = 'none';
  capa.style.display = 'block';
};



irPlanner.onclick=()=>{capa.style.display='none';planner.style.display='block';const p=load('perfil');if(p)perfilEl.textContent=`${p.nome} Â· ${p.signo}`;criarPlanner();};
irProspera.onclick=()=>{capa.style.display='none';prospera.style.display='block'};
voltarCapa.onclick=()=>{planner.style.display='none';capa.style.display='block'};
voltarCapa2.onclick=()=>{prospera.style.display='none';capa.style.display='block'};

mesAnterior.onclick=()=>{mesAtual--;if(mesAtual<0){mesAtual=11;anoAtual--;}criarPlanner()};
mesProximo.onclick=()=>{mesAtual++;if(mesAtual>11){mesAtual=0;anoAtual++;}criarPlanner()};

btnFechar.onclick=fecharModal;
btnSalvarNota.onclick=salvarNota;

              
            // ===== Registro do PWA =====
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('ğŸŒ™ GrimÃ³rio instalado como PWA'))
      .catch(err => console.error('Erro no Service Worker', err));
  });
}

// ===== PermissÃ£o de notificaÃ§Ãµes =====
function solicitarNotificacao() {
  if (!('Notification' in window)) return;
  if (Notification.permission === 'default') {
    Notification.requestPermission();
  }
}
function salvarLembrete(lembrete){
  const lista = load('lembretes') || [];
  lista.push(lembrete);
  save('lembretes', lista);
}


// ===== BotÃ£o "Instalar GrimÃ³rio" =====
let deferredPrompt;

window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  const btn = document.getElementById('btnInstalar');
  if (btn) btn.style.display = 'block';
});

document.getElementById('btnInstalar')?.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
});

function verificarSabaHoje(){
  if(Notification.permission !== 'granted') return;

  const hoje = new Date().toISOString().split('T')[0];
  const saba = sabas[hoje];
  if(!saba) return;

  navigator.serviceWorker.ready.then(reg=>{
    reg.showNotification(`ğŸ”¥ Hoje Ã© ${saba.nome}`,{
      body: saba.descricao,
      icon: 'icon-192.png',
      tag: 'saba-hoje'
    });
  });
}
function agendarVerificacaoDiaria(){
  const agora = new Date();
  const proxima = new Date();

  proxima.setHours(8,0,0,0);
  if(agora > proxima) proxima.setDate(proxima.getDate()+1);

  const delay = proxima - agora;

  setTimeout(()=>{
    verificarSabaHoje();
    setInterval(verificarSabaHoje, 24*60*60*1000);
  }, delay);
}

agendarVerificacaoDiaria();
const salvo = load('perfil');
if(salvo){}
  overlay.style.display='none';
  capa.style.display='block';
  nomeCapa.textContent=`Salve, ${salvo.nome}`;
</script>
</body>
</html>
.dias-semana div{text-align:center;font-weight:bold}

.preview{font-size:11px;margin-top:6px;font-style:italic}
.estrela{position:absolute;bottom:6px;right:8px;font-size:14px}
.iconesTopo{position:absolute;top:6px;right:8px;display:flex;gap:4px}

.top-nav{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.legenda{font-size:12px;margin:8px 0;display:flex;gap:12px}
            @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital@0;1&family=Great+Vibes&family=Cinzel:wght@400;600&family=UnifrakturCook:700&display=swap');

body{
  font-family:'Cinzel',serif;
  background:radial-gradient(circle at top,#6b003f,#3a0023,#1a0010);
  margin:0;padding:0;
  color:#f3e6c8;
}

body::before{
  content:'â˜¾ âœ¶ âš â˜¿ â™€ â™‚ âš— ğŸœƒ ğŸœ ğŸœ‚ ğŸœ„';
  position:fixed;
  inset:0;
  opacity:0.05;
  font-size:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}

main{
  display:grid;
  grid-template-columns: 2.2fr 1fr;
  gap:24px;
  max-width:1200px;
  margin:40px auto;
  padding:0 16px;
}

section{
  background:#2a0018;
  padding:28px;
  border-radius:22px;
  box-shadow:0 0 40px rgba(0,0,0,.6), inset 0 0 30px rgba(212,175,55,.12);
  border:2px solid #d4af37;
}

h1,h2,h3{
  color:#d4af37;
  font-family:'UnifrakturCook','Great Vibes',cursive;
}

h1{font-size:44px;text-align:center}
h2{font-size:30px;margin-top:0}
h3{font-size:22px}

.texto{
  color:#6b2f8a;
  font-size:14.5px;
  line-height:1.7;
  text-align:justify;
}

.livro label{
  display:block;
  margin-top:14px;
  font-size:13px;
}

.livro input{
  width:100%;
  box-sizing:border-box;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid #d4af37;
  background:#f8f1e8;
  font-family:'Cinzel',serif;
}

.caixa{
  box-sizing:border-box;

  background:#f4e8f6;
  color:#3a0023;
  padding:18px;
  border-radius:16px;
  margin-top:18px;
}

.lateral{
  position:sticky;
  top:24px;
}

.lunar{
  background:#1f0012;
  border:2px dashed #d4af37;
  padding:20px;
  border-radius:18px;
  font-size:14px;
}

.lunar strong{color:#d4af37}

.tabela{width:100%;border-collapse:collapse;margin-top:10px}
.tabela th,.tabela td{border-bottom:1px solid #d4af37;padding:6px}
.tabela input{
  width:100%;
  box-sizing:border-box;
  border:none;
  background:transparent;
  font-family:'Cinzel',serif;
}
button{margin-top:8px;background:#6b003f;color:#f3e6c8;border:1px solid #d4af37;border-radius:10px;padding:6px 10px;cursor:pointer}
button.remover{background:#3a0023;color:#d4af37}


/* cÃ¡lculos mÃ¡gicos */
.total-secao{
  margin-top:10px;
  font-size:14px;
  color:#6b003f;
  font-weight:600;
}
.saldo{
  margin-top:20px;
  padding:14px;
  background:#f0dff0;
  border-radius:14px;
  color:#3a0023;
  font-weight:600;
}
.grafico{
  margin-top:20px;
  background:#1f0012;
  border:1px solid #d4af37;
  border-radius:16px;
  padding:14px;
  color:#d4af37;
  font-size:13px;
}
  </style>
</head>
<body>

<!-- FORMULÃRIO -->
<div id="overlay">
  <div id="container">
    <h3>IdentificaÃ§Ã£o da Bruxa</h3>
    <label>Nome</label><input id="nome">
    <label>Signo</label><select id="signo"><option>Ãries</option><option>Touro</option><option>GÃªmeos</option><option>CÃ¢ncer</option><option>LeÃ£o</option><option>Virgem</option><option>Libra</option><option>EscorpiÃ£o</option><option>SagitÃ¡rio</option><option>CapricÃ³rnio</option><option>AquÃ¡rio</option><option>Peixes</option></select>
    <label>Ano pessoal</label><select id="anoPessoal"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option></select>
    <label>Ciclo menstrual</label><input id="ciclo" type="date">
    <button id="salvar">Entrar</button>
  </div>
</div>

<!-- CAPA -->
<button id="btnInstalar" style="display:none">
  ğŸ“² Instalar GrimÃ³rio
</button>

<div id="capa">
  <h2>Bem-vinda ao GrimÃ³rio</h2>
  <p id="nomeCapa"></p>
  <button id="irPlanner">Planner Mensal</button>
  <button id="irProspera">Livro da Bruxa PrÃ³spera</button>
</div>

<!-- PLANNER -->
<div id="planner">
  <div class="top-nav"><button id="voltarCapa">âŸµ Capa</button></div>
  <h2 id="perfil"></h2>
  <div class="legenda">
    <span>ğŸŒ‘ğŸŒ’ğŸŒ•ğŸŒ˜ LunaÃ§Ã£o</span>
    <span>ğŸ”¥ SabÃ¡</span>
    <span>â³ Lua fora de curso</span>
  </div>
  <div id="mesTitulo"></div>
  <div style="display:flex;justify-content:space-between;margin:10px 0">
    <button id="mesAnterior">â—€</button>
    <button id="mesProximo">â–¶</button>
  </div>
  <div class="grid dias-semana"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>SÃ¡b</div></div>
  <div class="grid" id="grid"></div>
</div>

<!-- MODAL -->
<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center">
  <div style="background:#fdfaf4;padding:20px;border-radius:12px;width:380px">
    <h3 id="modalTitulo"></h3>
    <div id="oraculo" style="color:#c2187a;font-style:italic"></div>
    <div id="notasSalvas"></div>
    <input type="time" id="notaHora" />
    <textarea id="notaTexto" style="height:80px"></textarea>
    <button id="btnSalvarNota">Salvar nota</button>
    <button id="btnFechar">Fechar</button>
  </div>
</div>

<!-- BRUXA PRÃ“SPERA -->
<div id="prospera">
  <div class="top-nav"><button id="voltarCapa2">âŸµ Capa</button></div>
 <h1>ğŸ“– Livro da Bruxa PrÃ³spera</h1>

<main>

  <section class="livro">

    <h2>âœ¦ Fonte de AbundÃ¢ncia</h2>
    <div class="texto">Registre todos os ganhos que chegam atÃ© vocÃª atravÃ©s do seu trabalho, trocas, serviÃ§os ou vendas.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>Origem do ganho</th><th>Valor</th><th></th></tr></thead>
        <tbody id="abundancia"></tbody>
      </table>
      <button onclick="addLinha('abundancia','ganho')">+ adicionar ganho</button>
      <div class="total-secao">Total AbundÃ¢ncia: R$ <span id="total-abundancia">0</span></div>
    </div>

    <h2 style="margin-top:34px">âœ¦ Fluidez</h2>
    <div class="texto">Aqui vocÃª observa para onde sua energia financeira escoa â€” como vocÃª gasta, sustenta e nutre sua vida.</div>

    <h3>A) Sustento</h3><div class="texto">Despesas essenciais para sua sobrevivÃªncia material: moradia, contas, transporte, alimentaÃ§Ã£o.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="sustento"></tbody>
      </table>
      <button onclick="addLinha('sustento')">+ adicionar gasto</button>
    </div>

    <h3>B) Florescimento</h3><div class="texto">Gastos que ampliam prazer, aprendizado, descanso, cultura e bem-estar.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="florescimento"></tbody>
      </table>
      <button onclick="addLinha('florescimento')">+ adicionar gasto</button>
    </div>

    <h3>C) Centelha EnergÃ©tica</h3><div class="texto">Gastos inesperados ou emergenciais que exigem energia imediata.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="centelha"></tbody>
      </table>
      <button onclick="addLinha('centelha')">+ adicionar gasto</button>
    </div>

    <h2 style="margin-top:34px">âœ¦ ExpansÃ£o</h2>
    <div class="texto">Reservas voltadas a investimentos futuros, sonhos, avanÃ§os e projetos de longo prazo.</div>
    <div class="caixa">
      <label>Sementes de Prosperidade</label>
      <input placeholder="Valor reservado">
      <label>Sonho ou intenÃ§Ã£o</label>
      <input placeholder="Liberdade, descanso, projeto...">
    </div>

        <div id="totais">
        <div class="total-secao">Total Sustento: R$ <span id="total-sustento">0</span></div>
        <div class="total-secao">Total Florescimento: R$ <span id="total-florescimento">0</span></div>
        <div class="total-secao">Total Centelha: R$ <span id="total-centelha">0</span></div>
        <div class="saldo">Saldo EnergÃ©tico do MÃªs: R$ <span id="saldo">0</span></div>
      </div>

  </section>

  <aside class="lateral">
    <section class="lunar">
      <h3>ğŸŒ™ A Lua Observa Teu Ouro</h3>
      <p><strong>Lua Nova:</strong> planeje, defina metas, evite impulsos.</p>
      <p><strong>Lua Crescente:</strong> organize, negocie, expanda.</p>
      <p><strong>Lua Cheia:</strong> agradeÃ§a, observe excessos.</p>
      <p><strong>Lua Minguante:</strong> corte gastos e libere padrÃµes.</p>
      <div class="grafico" id="grafico">ğŸ“Š GrÃ¡fico Ritual: Fluidez x Lua<br>(ativaÃ§Ã£o simbÃ³lica)</div>
    </section>
  </aside>

</main>

<script>
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
    
function recalcular(){
  const categorias=['sustento','florescimento','centelha','abundancia'];
  let somaTotal=0;

  categorias.forEach(cat=>{
    let soma=0;
    document.querySelectorAll(`#${cat} input[type="number"]`).forEach(i=>{
      soma+=Number(i.value)||0;
    });
    if(document.getElementById(`total-${cat}`)){
      document.getElementById(`total-${cat}`).textContent=soma.toFixed(2);
    }
    somaTotal+=soma;
  });

  const totalAbundancia = Number(document.getElementById('total-abundancia').textContent)||0;
  document.getElementById('saldo').textContent=(totalAbundancia - somaTotal).toFixed(2);
}

function addLinha(id,tipo){
  const tbody = document.getElementById(id);
  if(!tbody) return;

  const tr = document.createElement('tr');

  const tdDesc = document.createElement('td');
  const inputDesc = document.createElement('input');
  inputDesc.placeholder = tipo==='ganho' ? 'Descreva o ganho' : 'Descreva o gasto';
  tdDesc.appendChild(inputDesc);

  const tdValor = document.createElement('td');
  const inputValor = document.createElement('input');
  inputValor.type = 'number';
  inputValor.placeholder = '0.00';
  inputValor.oninput = recalcular;
  tdValor.appendChild(inputValor);

  const tdAcao = document.createElement('td');
  const btnRemover = document.createElement('button');
  btnRemover.textContent = 'âœ–';
  btnRemover.className = 'remover';
  btnRemover.onclick = () => tr.remove();
  tdAcao.appendChild(btnRemover);

  tr.appendChild(tdDesc);
  tr.appendChild(tdValor);
  tr.appendChild(tdAcao);

  tbody.appendChild(tr);
}

// testes mÃ­nimos automÃ¡ticos
addLinha('sustento');
addLinha('abundancia','ganho');
addLinha('florescimento');
addLinha('centelha');
function load(k){const v=localStorage.getItem(k);return v?JSON.parse(v):null}

const overlay=document.getElementById('overlay');
const capa=document.getElementById('capa');
const planner=document.getElementById('planner');
const prospera=document.getElementById('prospera');
const grid=document.getElementById('grid');
const mesTitulo=document.getElementById('mesTitulo');
const perfilEl=document.getElementById('perfil');

let mesAtual=new Date().getMonth();
let anoAtual=2026;
let diaAtual=null;


// ===== Dados lunares (2026 completo) =====
const lunacoes2026={
  '2026-01-03':{fase:'Lua Cheia', signo:'CÃ¢ncer', icone:'ğŸŒ•'},
  '2026-01-10':{fase:'Lua Minguante', signo:'Libra', icone:'ğŸŒ˜'},
  '2026-01-18':{fase:'Lua Nova', signo:'CapricÃ³rnio', icone:'ğŸŒ‘'},
  '2026-01-26':{fase:'Lua Crescente', signo:'Touro', icone:'ğŸŒ’'},
  '2026-02-01':{fase:'Lua Cheia', signo:'LeÃ£o', icone:'ğŸŒ•'},
  '2026-02-09':{fase:'Lua Minguante', signo:'EscorpiÃ£o', icone:'ğŸŒ˜'},
  '2026-02-17':{fase:'Lua Nova', signo:'AquÃ¡rio', icone:'ğŸŒ‘'},
  '2026-02-24':{fase:'Lua Crescente', signo:'GÃªmeos', icone:'ğŸŒ’'},
  '2026-03-03':{fase:'Lua Cheia', signo:'Virgem', icone:'ğŸŒ•'},
  '2026-03-11':{fase:'Lua Minguante', signo:'SagitÃ¡rio', icone:'ğŸŒ˜'},
  '2026-03-18':{fase:'Lua Nova', signo:'Peixes', icone:'ğŸŒ‘'},
  '2026-03-25':{fase:'Lua Crescente', signo:'CÃ¢ncer', icone:'ğŸŒ’'},
  '2026-04-01':{fase:'Lua Cheia', signo:'Libra', icone:'ğŸŒ•'},
  '2026-04-10':{fase:'Lua Minguante', signo:'CapricÃ³rnio', icone:'ğŸŒ˜'},
  '2026-04-17':{fase:'Lua Nova', signo:'Ãries', icone:'ğŸŒ‘'},
  '2026-04-23':{fase:'Lua Crescente', signo:'LeÃ£o', icone:'ğŸŒ’'},
  '2026-05-01':{fase:'Lua Cheia', signo:'EscorpiÃ£o', icone:'ğŸŒ•'},
  '2026-05-09':{fase:'Lua Minguante', signo:'AquÃ¡rio', icone:'ğŸŒ˜'},
  '2026-05-16':{fase:'Lua Nova', signo:'Touro', icone:'ğŸŒ‘'},
  '2026-05-23':{fase:'Lua Crescente', signo:'Virgem', icone:'ğŸŒ’'},
  '2026-05-31':{fase:'Lua Cheia', signo:'SagitÃ¡rio', icone:'ğŸŒ•'},
  '2026-06-08':{fase:'Lua Minguante', signo:'Peixes', icone:'ğŸŒ˜'},
  '2026-06-14':{fase:'Lua Nova', signo:'GÃªmeos', icone:'ğŸŒ‘'},
  '2026-06-21':{fase:'Lua Crescente', signo:'Virgem', icone:'ğŸŒ’'},
  '2026-06-29':{fase:'Lua Cheia', signo:'CapricÃ³rnio', icone:'ğŸŒ•'},
  '2026-07-07':{fase:'Lua Minguante', signo:'Ãries', icone:'ğŸŒ˜'},
  '2026-07-14':{fase:'Lua Nova', signo:'CÃ¢ncer', icone:'ğŸŒ‘'},
  '2026-07-21':{fase:'Lua Crescente', signo:'EscorpiÃ£o', icone:'ğŸŒ’'},
  '2026-07-29':{fase:'Lua Cheia', signo:'AquÃ¡rio', icone:'ğŸŒ•'},
  '2026-08-05':{fase:'Lua Minguante', signo:'Touro', icone:'ğŸŒ˜'},
  '2026-08-12':{fase:'Lua Nova', signo:'LeÃ£o', icone:'ğŸŒ‘'},
  '2026-08-19':{fase:'Lua Crescente', signo:'EscorpiÃ£o', icone:'ğŸŒ’'},
  '2026-08-28':{fase:'Lua Cheia', signo:'Peixes', icone:'ğŸŒ•'},
  '2026-09-04':{fase:'Lua Minguante', signo:'GÃªmeos', icone:'ğŸŒ˜'},
  '2026-09-11':{fase:'Lua Nova', signo:'Virgem', icone:'ğŸŒ‘'},
  '2026-09-18':{fase:'Lua Crescente', signo:'SagitÃ¡rio', icone:'ğŸŒ’'},
  '2026-09-26':{fase:'Lua Cheia', signo:'Ãries', icone:'ğŸŒ•'},
  '2026-10-03':{fase:'Lua Minguante', signo:'CÃ¢ncer', icone:'ğŸŒ˜'},
  '2026-10-10':{fase:'Lua Nova', signo:'Libra', icone:'ğŸŒ‘'},
  '2026-10-18':{fase:'Lua Crescente', signo:'AquÃ¡rio', icone:'ğŸŒ’'},
  '2026-10-26':{fase:'Lua Cheia', signo:'Touro', icone:'ğŸŒ•'},
  '2026-11-01':{fase:'Lua Minguante', signo:'LeÃ£o', icone:'ğŸŒ˜'},
  '2026-11-09':{fase:'Lua Nova', signo:'EscorpiÃ£o', icone:'ğŸŒ‘'},
  '2026-11-17':{fase:'Lua Crescente', signo:'Peixes', icone:'ğŸŒ’'},
  '2026-11-24':{fase:'Lua Cheia', signo:'GÃªmeos', icone:'ğŸŒ•'},
  '2026-12-01':{fase:'Lua Minguante', signo:'Virgem', icone:'ğŸŒ˜'},
  '2026-12-08':{fase:'Lua Nova', signo:'SagitÃ¡rio', icone:'ğŸŒ‘'},
  '2026-12-17':{fase:'Lua Crescente', signo:'Peixes', icone:'ğŸŒ’'},
  '2026-12-23':{fase:'Lua Cheia', signo:'GÃªmeos', icone:'ğŸŒ•'},
  '2026-12-30':{fase:'Lua Minguante', signo:'Libra', icone:'ğŸŒ˜'}
};
const sabas={
  '2026-02-01':{nome:'Lughnasadh',descricao:'Assar pÃ£es e bolos de grÃ£os, expressar gratidÃ£o pela fartura, agradecer pelos frutos colhidos e realizar ritual de colheita e prosperidade.'},
  '2026-03-20':{nome:'Mabon',descricao:'Oferendas de maÃ§Ã£s e frutas da estaÃ§Ã£o, partilha de banquetes, agradecimento pela colheita e rituais de equilÃ­brio e gratidÃ£o.'},
  '2026-05-01':{nome:'Samhain',descricao:'Honrar ancestrais, limpar altares, queimar pedidos ou banimentos, praticar divinaÃ§Ã£o e introspecÃ§Ã£o profunda.'},
  '2026-06-21':{nome:'Yule',descricao:'Acender a tora de Yule ou velas, decorar com sÃ­mbolos de vida eterna, celebrar o renascimento do sol e trocar presentes simbÃ³licos.'},
  '2026-08-01':{nome:'Imbolc',descricao:'Acender velas em honra a BrÃ­gida, realizar limpezas energÃ©ticas, rituais de purificaÃ§Ã£o, proteÃ§Ã£o e preparaÃ§Ã£o para a luz.'},
  '2026-09-22':{nome:'Ostara',descricao:'Plantio de sementes fÃ­sicas ou simbÃ³licas, decoraÃ§Ã£o de ovos, rituais de fertilidade, renovaÃ§Ã£o e equilÃ­brio.'},
  '2026-10-31':{nome:'Beltane',descricao:'DanÃ§ar ao redor do mastro de maio, acender fogueiras de proteÃ§Ã£o, celebrar amor, prazer, uniÃ£o e fertilidade.'},
  '2026-12-21':{nome:'Litha',descricao:'Rituais ao ar livre para absorver energia solar, colheita de ervas, fogueiras, mÃºsica, danÃ§a e honra ao Ã¡pice da luz.'}
};
const luaForaDeCurso={
  '2026-01-02':'09:23â€“10:09',
  '2026-02-05':'14:10â€“15:02',
  '2026-03-07':'22:40â€“23:30',
  '2026-04-11':'06:15â€“07:01',
  '2026-05-04':'18:50â€“19:44',
  '2026-06-09':'03:12â€“04:00',
  '2026-07-12':'11:30â€“12:18',
  '2026-08-06':'20:05â€“21:00',
  '2026-09-10':'08:44â€“09:33',
  '2026-10-08':'16:10â€“17:02',
  '2026-11-09':'01:22â€“02:10',
  '2026-12-07':'13:40â€“14:28'
};

function criarPlanner(){
  grid.innerHTML='';
  const total=new Date(anoAtual,mesAtual+1,0).getDate();
  const inicio=new Date(anoAtual,mesAtual,1).getDay();
  mesTitulo.textContent=new Date(anoAtual,mesAtual).toLocaleString('pt-BR',{month:'long',year:'numeric'});

  for(let i=0;i<inicio;i++){const v=document.createElement('div');v.style.visibility='hidden';grid.appendChild(v);}

  const notas=load('notas')||{};

  for(let d=1;d<=total;d++){
    const dataISO=`${anoAtual}-${String(mesAtual+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const el=document.createElement('div');el.className='dia';

    let icones='';
    if(lunacoes2026[dataISO]) icones+=lunacoes2026[dataISO].icone;
    if(sabas[dataISO]) icones+='ğŸ”¥';
    if(luaForaDeCurso[dataISO]) icones+='â³';

    el.innerHTML=`<strong>${d}</strong>`+(icones?`<div class="iconesTopo">${icones}</div>`:'');

    if(Array.isArray(notas[dataISO]) && notas[dataISO].length){
      el.innerHTML+=`<span class="estrela">âœ¶</span>`;
      const p=document.createElement('div');p.className='preview';p.textContent=notas[dataISO][notas[dataISO].length-1].texto;el.appendChild(p);
    }

    el.addEventListener('click',()=>abrirModal(dataISO,d));
    grid.appendChild(el);
  }
}

// ===== OrÃ¡culo diÃ¡rio =====
function avaliarDia(dataISO){
  const perfil=load('perfil')||{};
  const lua=lunacoes2026[dataISO];

  let linha1='';
  if(lua){
    linha1=`<strong>${lua.fase} em ${lua.signo}:</strong> ${significadoLua(lua.fase, lua.signo)}`;
  } else {
    linha1='<strong>Lua em trÃ¢nsito:</strong> continuidade do ciclo lunar em andamento.';
  }

  const numero=perfil.ano||'';
  const linha2=`<strong>Energia do dia:</strong> ${energiaDoDia(lua?.fase, numero, perfil.ciclo)}`;

  const linha3=`<strong>Ritual sugerido:</strong> ${ritualDoDia(lua?.fase, lua?.signo, dataISO)}`;

  return `${linha1}<br><br>${linha2}<br><br>${linha3}`;
}

function significadoLua(fase, signo){
  return `${fase.toLowerCase()} filtrada pela energia de ${signo}, ativando temas simbÃ³licos do signo.`;
}

function energiaDoDia(fase, numero, ciclo){
  let base=fase||'fluxo contÃ­nuo';
  let n=numero?` alinhado ao nÃºmero pessoal ${numero}`:'';
  let c=ciclo?' com influÃªncia corporal ativa':'';
  return `movimento interno guiado pela ${base}${n}${c}.`;
}

function ritualDoDia(fase, signo, dataISO){
  if(sabas[dataISO]){
    return `celebraÃ§Ã£o de ${sabas[dataISO].nome}: ${sabas[dataISO].descricao}`;
  }
  if(fase==='Lua Cheia') return 'ritual de gratidÃ£o, escrita consciente e celebraÃ§Ã£o simbÃ³lica.';
  if(fase==='Lua Nova') return 'plantio de intenÃ§Ãµes, silÃªncio ritual e visualizaÃ§Ã£o.';
  if(fase==='Lua Crescente') return 'aÃ§Ãµes progressivas, fortalecimento de hÃ¡bitos e foco.';
  if(fase==='Lua Minguante') return 'limpeza energÃ©tica, desapego e descanso consciente.';
  return 'prÃ¡tica simples de autocuidado e observaÃ§Ã£o.';
}

function abrirModal(dataISO,dia){
  diaAtual=dataISO;
  modalTitulo.textContent=`Dia ${dia}`;
  oraculo.innerHTML=avaliarDia(dataISO);
  notasSalvas.innerHTML='';
  const notas=load('notas')||{};
  if(Array.isArray(notas[dataISO])){
    notas[dataISO].forEach(n=>{const p=document.createElement('p');p.textContent=`${n.hora||''} â€” ${n.texto}`;notasSalvas.appendChild(p);});
  }
  modal.style.display='flex';
}

function fecharModal(){modal.style.display='none';notaTexto.value='';notaHora.value='';}

function salvarNota(){
  if(!notaTexto.value.trim()) return;
  const notas=load('notas')||{};
  if(!Array.isArray(notas[diaAtual])) notas[diaAtual]=[];
  notas[diaAtual].push({hora:notaHora.value,texto:notaTexto.value});
  save('notas',notas);
  fecharModal();criarPlanner();
}

salvar.onclick = () => {
  const perfil = {
    nome: nome.value,
    signo: signo.value,
    ano: anoPessoal.value,
    ciclo: ciclo.value
  };

  save('perfil', perfil);
  solicitarNotificacao(); // aqui estÃ¡ correto
  nomeCapa.textContent = `Salve, ${perfil.nome}`;

  overlay.style.display = 'none';
  capa.style.display = 'block';
};



irPlanner.onclick=()=>{capa.style.display='none';planner.style.display='block';const p=load('perfil');if(p)perfilEl.textContent=`${p.nome} Â· ${p.signo}`;criarPlanner();};
irProspera.onclick=()=>{capa.style.display='none';prospera.style.display='block'};
voltarCapa.onclick=()=>{planner.style.display='none';capa.style.display='block'};
voltarCapa2.onclick=()=>{prospera.style.display='none';capa.style.display='block'};

mesAnterior.onclick=()=>{mesAtual--;if(mesAtual<0){mesAtual=11;anoAtual--;}criarPlanner()};
mesProximo.onclick=()=>{mesAtual++;if(mesAtual>11){mesAtual=0;anoAtual++;}criarPlanner()};

btnFechar.onclick=fecharModal;
btnSalvarNota.onclick=salvarNota;

              
            // ===== Registro do PWA =====
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('ğŸŒ™ GrimÃ³rio instalado como PWA'))
      .catch(err => console.error('Erro no Service Worker', err));
  });
}

// ===== PermissÃ£o de notificaÃ§Ãµes =====
function solicitarNotificacao() {
  if (!('Notification' in window)) return;
  if (Notification.permission === 'default') {
    Notification.requestPermission();
  }
}
function salvarLembrete(lembrete){
  const lista = load('lembretes') || [];
  lista.push(lembrete);
  save('lembretes', lista);
}


// ===== BotÃ£o "Instalar GrimÃ³rio" =====
let deferredPrompt;

window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  const btn = document.getElementById('btnInstalar');
  if (btn) btn.style.display = 'block';
});

document.getElementById('btnInstalar')?.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
});

function verificarSabaHoje(){
  if(Notification.permission !== 'granted') return;

  const hoje = new Date().toISOString().split('T')[0];
  const saba = sabas[hoje];
  if(!saba) return;

  navigator.serviceWorker.ready.then(reg=>{
    reg.showNotification(`ğŸ”¥ Hoje Ã© ${saba.nome}`,{
      body: saba.descricao,
      icon: 'icon-192.png',
      tag: 'saba-hoje'
    });
  });
}
function agendarVerificacaoDiaria(){
  const agora = new Date();
  const proxima = new Date();

  proxima.setHours(8,0,0,0);
  if(agora > proxima) proxima.setDate(proxima.getDate()+1);

  const delay = proxima - agora;

  setTimeout(()=>{
    verificarSabaHoje();
    setInterval(verificarSabaHoje, 24*60*60*1000);
  }, delay);
}

agendarVerificacaoDiaria();
const salvo = load('perfil');
if(salvo){}
  overlay.style.display='none';
  capa.style.display='block';
  nomeCapa.textContent=`Salve, ${salvo.nome}`;

</script>
</body>
</html>
.dias-semana div{text-align:center;font-weight:bold}

.preview{font-size:11px;margin-top:6px;font-style:italic}
.estrela{position:absolute;bottom:6px;right:8px;font-size:14px}
.iconesTopo{position:absolute;top:6px;right:8px;display:flex;gap:4px}

.top-nav{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.legenda{font-size:12px;margin:8px 0;display:flex;gap:12px}
            @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital@0;1&family=Great+Vibes&family=Cinzel:wght@400;600&family=UnifrakturCook:700&display=swap');

body{
  font-family:'Cinzel',serif;
  background:radial-gradient(circle at top,#6b003f,#3a0023,#1a0010);
  margin:0;padding:0;
  color:#f3e6c8;
}

body::before{
  content:'â˜¾ âœ¶ âš â˜¿ â™€ â™‚ âš— ğŸœƒ ğŸœ ğŸœ‚ ğŸœ„';
  position:fixed;
  inset:0;
  opacity:0.05;
  font-size:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}

main{
  display:grid;
  grid-template-columns: 2.2fr 1fr;
  gap:24px;
  max-width:1200px;
  margin:40px auto;
  padding:0 16px;
}

section{
  background:#2a0018;
  padding:28px;
  border-radius:22px;
  box-shadow:0 0 40px rgba(0,0,0,.6), inset 0 0 30px rgba(212,175,55,.12);
  border:2px solid #d4af37;
}

h1,h2,h3{
  color:#d4af37;
  font-family:'UnifrakturCook','Great Vibes',cursive;
}

h1{font-size:44px;text-align:center}
h2{font-size:30px;margin-top:0}
h3{font-size:22px}

.texto{
  color:#6b2f8a;
  font-size:14.5px;
  line-height:1.7;
  text-align:justify;
}

.livro label{
  display:block;
  margin-top:14px;
  font-size:13px;
}

.livro input{
  width:100%;
  box-sizing:border-box;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid #d4af37;
  background:#f8f1e8;
  font-family:'Cinzel',serif;
}

.caixa{
  box-sizing:border-box;

  background:#f4e8f6;
  color:#3a0023;
  padding:18px;
  border-radius:16px;
  margin-top:18px;
}

.lateral{
  position:sticky;
  top:24px;
}

.lunar{
  background:#1f0012;
  border:2px dashed #d4af37;
  padding:20px;
  border-radius:18px;
  font-size:14px;
}

.lunar strong{color:#d4af37}

.tabela{width:100%;border-collapse:collapse;margin-top:10px}
.tabela th,.tabela td{border-bottom:1px solid #d4af37;padding:6px}
.tabela input{
  width:100%;
  box-sizing:border-box;
  border:none;
  background:transparent;
  font-family:'Cinzel',serif;
}
button{margin-top:8px;background:#6b003f;color:#f3e6c8;border:1px solid #d4af37;border-radius:10px;padding:6px 10px;cursor:pointer}
button.remover{background:#3a0023;color:#d4af37}


/* cÃ¡lculos mÃ¡gicos */
.total-secao{
  margin-top:10px;
  font-size:14px;
  color:#6b003f;
  font-weight:600;
}
.saldo{
  margin-top:20px;
  padding:14px;
  background:#f0dff0;
  border-radius:14px;
  color:#3a0023;
  font-weight:600;
}
.grafico{
  margin-top:20px;
  background:#1f0012;
  border:1px solid #d4af37;
  border-radius:16px;
  padding:14px;
  color:#d4af37;
  font-size:13px;
}
  </style>
</head>
<body>

<!-- FORMULÃRIO -->
<div id="overlay">
  <div id="container">
    <h3>IdentificaÃ§Ã£o da Bruxa</h3>
    <label>Nome</label><input id="nome">
    <label>Signo</label><select id="signo"><option>Ãries</option><option>Touro</option><option>GÃªmeos</option><option>CÃ¢ncer</option><option>LeÃ£o</option><option>Virgem</option><option>Libra</option><option>EscorpiÃ£o</option><option>SagitÃ¡rio</option><option>CapricÃ³rnio</option><option>AquÃ¡rio</option><option>Peixes</option></select>
    <label>Ano pessoal</label><select id="anoPessoal"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option></select>
    <label>Ciclo menstrual</label><input id="ciclo" type="date">
    <button id="salvar">Entrar</button>
  </div>
</div>

<!-- CAPA -->
<button id="btnInstalar" style="display:none">
  ğŸ“² Instalar GrimÃ³rio
</button>

<div id="capa">
  <h2>Bem-vinda ao GrimÃ³rio</h2>
  <p id="nomeCapa"></p>
  <button id="irPlanner">Planner Mensal</button>
  <button id="irProspera">Livro da Bruxa PrÃ³spera</button>
</div>

<!-- PLANNER -->
<div id="planner">
  <div class="top-nav"><button id="voltarCapa">âŸµ Capa</button></div>
  <h2 id="perfil"></h2>
  <div class="legenda">
    <span>ğŸŒ‘ğŸŒ’ğŸŒ•ğŸŒ˜ LunaÃ§Ã£o</span>
    <span>ğŸ”¥ SabÃ¡</span>
    <span>â³ Lua fora de curso</span>
  </div>
  <div id="mesTitulo"></div>
  <div style="display:flex;justify-content:space-between;margin:10px 0">
    <button id="mesAnterior">â—€</button>
    <button id="mesProximo">â–¶</button>
  </div>
  <div class="grid dias-semana"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>SÃ¡b</div></div>
  <div class="grid" id="grid"></div>
</div>

<!-- MODAL -->
<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center">
  <div style="background:#fdfaf4;padding:20px;border-radius:12px;width:380px">
    <h3 id="modalTitulo"></h3>
    <div id="oraculo" style="color:#c2187a;font-style:italic"></div>
    <div id="notasSalvas"></div>
    <input type="time" id="notaHora" />
    <textarea id="notaTexto" style="height:80px"></textarea>
    <button id="btnSalvarNota">Salvar nota</button>
    <button id="btnFechar">Fechar</button>
  </div>
</div>

<!-- BRUXA PRÃ“SPERA -->
<div id="prospera">
  <div class="top-nav"><button id="voltarCapa2">âŸµ Capa</button></div>
 <h1>ğŸ“– Livro da Bruxa PrÃ³spera</h1>

<main>

  <section class="livro">

    <h2>âœ¦ Fonte de AbundÃ¢ncia</h2>
    <div class="texto">Registre todos os ganhos que chegam atÃ© vocÃª atravÃ©s do seu trabalho, trocas, serviÃ§os ou vendas.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>Origem do ganho</th><th>Valor</th><th></th></tr></thead>
        <tbody id="abundancia"></tbody>
      </table>
      <button onclick="addLinha('abundancia','ganho')">+ adicionar ganho</button>
      <div class="total-secao">Total AbundÃ¢ncia: R$ <span id="total-abundancia">0</span></div>
    </div>

    <h2 style="margin-top:34px">âœ¦ Fluidez</h2>
    <div class="texto">Aqui vocÃª observa para onde sua energia financeira escoa â€” como vocÃª gasta, sustenta e nutre sua vida.</div>

    <h3>A) Sustento</h3><div class="texto">Despesas essenciais para sua sobrevivÃªncia material: moradia, contas, transporte, alimentaÃ§Ã£o.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="sustento"></tbody>
      </table>
      <button onclick="addLinha('sustento')">+ adicionar gasto</button>
    </div>

    <h3>B) Florescimento</h3><div class="texto">Gastos que ampliam prazer, aprendizado, descanso, cultura e bem-estar.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="florescimento"></tbody>
      </table>
      <button onclick="addLinha('florescimento')">+ adicionar gasto</button>
    </div>

    <h3>C) Centelha EnergÃ©tica</h3><div class="texto">Gastos inesperados ou emergenciais que exigem energia imediata.</div>
    <div class="caixa">
      <table class="tabela">
        <thead><tr><th>DescriÃ§Ã£o</th><th>Valor</th><th></th></tr></thead>
        <tbody id="centelha"></tbody>
      </table>
      <button onclick="addLinha('centelha')">+ adicionar gasto</button>
    </div>

    <h2 style="margin-top:34px">âœ¦ ExpansÃ£o</h2>
    <div class="texto">Reservas voltadas a investimentos futuros, sonhos, avanÃ§os e projetos de longo prazo.</div>
    <div class="caixa">
      <label>Sementes de Prosperidade</label>
      <input placeholder="Valor reservado">
      <label>Sonho ou intenÃ§Ã£o</label>
      <input placeholder="Liberdade, descanso, projeto...">
    </div>

        <div id="totais">
        <div class="total-secao">Total Sustento: R$ <span id="total-sustento">0</span></div>
        <div class="total-secao">Total Florescimento: R$ <span id="total-florescimento">0</span></div>
        <div class="total-secao">Total Centelha: R$ <span id="total-centelha">0</span></div>
        <div class="saldo">Saldo EnergÃ©tico do MÃªs: R$ <span id="saldo">0</span></div>
      </div>

  </section>

  <aside class="lateral">
    <section class="lunar">
      <h3>ğŸŒ™ A Lua Observa Teu Ouro</h3>
      <p><strong>Lua Nova:</strong> planeje, defina metas, evite impulsos.</p>
      <p><strong>Lua Crescente:</strong> organize, negocie, expanda.</p>
      <p><strong>Lua Cheia:</strong> agradeÃ§a, observe excessos.</p>
      <p><strong>Lua Minguante:</strong> corte gastos e libere padrÃµes.</p>
      <div class="grafico" id="grafico">ğŸ“Š GrÃ¡fico Ritual: Fluidez x Lua<br>(ativaÃ§Ã£o simbÃ³lica)</div>
    </section>
  </aside>

</main>

<script>
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
    
function recalcular(){
  const categorias=['sustento','florescimento','centelha','abundancia'];
  let somaTotal=0;

  categorias.forEach(cat=>{
    let soma=0;
    document.querySelectorAll(`#${cat} input[type="number"]`).forEach(i=>{
      soma+=Number(i.value)||0;
    });
    if(document.getElementById(`total-${cat}`)){
      document.getElementById(`total-${cat}`).textContent=soma.toFixed(2);
    }
    somaTotal+=soma;
  });

  const totalAbundancia = Number(document.getElementById('total-abundancia').textContent)||0;
  document.getElementById('saldo').textContent=(totalAbundancia - somaTotal).toFixed(2);
}

function addLinha(id,tipo){
  const tbody = document.getElementById(id);
  if(!tbody) return;

  const tr = document.createElement('tr');

  const tdDesc = document.createElement('td');
  const inputDesc = document.createElement('input');
  inputDesc.placeholder = tipo==='ganho' ? 'Descreva o ganho' : 'Descreva o gasto';
  tdDesc.appendChild(inputDesc);

  const tdValor = document.createElement('td');
  const inputValor = document.createElement('input');
  inputValor.type = 'number';
  inputValor.placeholder = '0.00';
  inputValor.oninput = recalcular;
  tdValor.appendChild(inputValor);

  const tdAcao = document.createElement('td');
  const btnRemover = document.createElement('button');
  btnRemover.textContent = 'âœ–';
  btnRemover.className = 'remover';
  btnRemover.onclick = () => tr.remove();
  tdAcao.appendChild(btnRemover);

  tr.appendChild(tdDesc);
  tr.appendChild(tdValor);
  tr.appendChild(tdAcao);

  tbody.appendChild(tr);
}

// testes mÃ­nimos automÃ¡ticos
addLinha('sustento');
addLinha('abundancia','ganho');
addLinha('florescimento');
addLinha('centelha');
function load(k){const v=localStorage.getItem(k);return v?JSON.parse(v):null}

const overlay=document.getElementById('overlay');
const capa=document.getElementById('capa');
const planner=document.getElementById('planner');
const prospera=document.getElementById('prospera');
const grid=document.getElementById('grid');
const mesTitulo=document.getElementById('mesTitulo');
const perfilEl=document.getElementById('perfil');

let mesAtual=new Date().getMonth();
let anoAtual=2026;
let diaAtual=null;


// ===== Dados lunares (2026 completo) =====
const lunacoes2026={
  '2026-01-03':{fase:'Lua Cheia', signo:'CÃ¢ncer', icone:'ğŸŒ•'},
  '2026-01-10':{fase:'Lua Minguante', signo:'Libra', icone:'ğŸŒ˜'},
  '2026-01-18':{fase:'Lua Nova', signo:'CapricÃ³rnio', icone:'ğŸŒ‘'},
  '2026-01-26':{fase:'Lua Crescente', signo:'Touro', icone:'ğŸŒ’'},
  '2026-02-01':{fase:'Lua Cheia', signo:'LeÃ£o', icone:'ğŸŒ•'},
  '2026-02-09':{fase:'Lua Minguante', signo:'EscorpiÃ£o', icone:'ğŸŒ˜'},
  '2026-02-17':{fase:'Lua Nova', signo:'AquÃ¡rio', icone:'ğŸŒ‘'},
  '2026-02-24':{fase:'Lua Crescente', signo:'GÃªmeos', icone:'ğŸŒ’'},
  '2026-03-03':{fase:'Lua Cheia', signo:'Virgem', icone:'ğŸŒ•'},
  '2026-03-11':{fase:'Lua Minguante', signo:'SagitÃ¡rio', icone:'ğŸŒ˜'},
  '2026-03-18':{fase:'Lua Nova', signo:'Peixes', icone:'ğŸŒ‘'},
  '2026-03-25':{fase:'Lua Crescente', signo:'CÃ¢ncer', icone:'ğŸŒ’'},
  '2026-04-01':{fase:'Lua Cheia', signo:'Libra', icone:'ğŸŒ•'},
  '2026-04-10':{fase:'Lua Minguante', signo:'CapricÃ³rnio', icone:'ğŸŒ˜'},
  '2026-04-17':{fase:'Lua Nova', signo:'Ãries', icone:'ğŸŒ‘'},
  '2026-04-23':{fase:'Lua Crescente', signo:'LeÃ£o', icone:'ğŸŒ’'},
  '2026-05-01':{fase:'Lua Cheia', signo:'EscorpiÃ£o', icone:'ğŸŒ•'},
  '2026-05-09':{fase:'Lua Minguante', signo:'AquÃ¡rio', icone:'ğŸŒ˜'},
  '2026-05-16':{fase:'Lua Nova', signo:'Touro', icone:'ğŸŒ‘'},
  '2026-05-23':{fase:'Lua Crescente', signo:'Virgem', icone:'ğŸŒ’'},
  '2026-05-31':{fase:'Lua Cheia', signo:'SagitÃ¡rio', icone:'ğŸŒ•'},
  '2026-06-08':{fase:'Lua Minguante', signo:'Peixes', icone:'ğŸŒ˜'},
  '2026-06-14':{fase:'Lua Nova', signo:'GÃªmeos', icone:'ğŸŒ‘'},
  '2026-06-21':{fase:'Lua Crescente', signo:'Virgem', icone:'ğŸŒ’'},
  '2026-06-29':{fase:'Lua Cheia', signo:'CapricÃ³rnio', icone:'ğŸŒ•'},
  '2026-07-07':{fase:'Lua Minguante', signo:'Ãries', icone:'ğŸŒ˜'},
  '2026-07-14':{fase:'Lua Nova', signo:'CÃ¢ncer', icone:'ğŸŒ‘'},
  '2026-07-21':{fase:'Lua Crescente', signo:'EscorpiÃ£o', icone:'ğŸŒ’'},
  '2026-07-29':{fase:'Lua Cheia', signo:'AquÃ¡rio', icone:'ğŸŒ•'},
  '2026-08-05':{fase:'Lua Minguante', signo:'Touro', icone:'ğŸŒ˜'},
  '2026-08-12':{fase:'Lua Nova', signo:'LeÃ£o', icone:'ğŸŒ‘'},
  '2026-08-19':{fase:'Lua Crescente', signo:'EscorpiÃ£o', icone:'ğŸŒ’'},
  '2026-08-28':{fase:'Lua Cheia', signo:'Peixes', icone:'ğŸŒ•'},
  '2026-09-04':{fase:'Lua Minguante', signo:'GÃªmeos', icone:'ğŸŒ˜'},
  '2026-09-11':{fase:'Lua Nova', signo:'Virgem', icone:'ğŸŒ‘'},
  '2026-09-18':{fase:'Lua Crescente', signo:'SagitÃ¡rio', icone:'ğŸŒ’'},
  '2026-09-26':{fase:'Lua Cheia', signo:'Ãries', icone:'ğŸŒ•'},
  '2026-10-03':{fase:'Lua Minguante', signo:'CÃ¢ncer', icone:'ğŸŒ˜'},
  '2026-10-10':{fase:'Lua Nova', signo:'Libra', icone:'ğŸŒ‘'},
  '2026-10-18':{fase:'Lua Crescente', signo:'AquÃ¡rio', icone:'ğŸŒ’'},
  '2026-10-26':{fase:'Lua Cheia', signo:'Touro', icone:'ğŸŒ•'},
  '2026-11-01':{fase:'Lua Minguante', signo:'LeÃ£o', icone:'ğŸŒ˜'},
  '2026-11-09':{fase:'Lua Nova', signo:'EscorpiÃ£o', icone:'ğŸŒ‘'},
  '2026-11-17':{fase:'Lua Crescente', signo:'Peixes', icone:'ğŸŒ’'},
  '2026-11-24':{fase:'Lua Cheia', signo:'GÃªmeos', icone:'ğŸŒ•'},
  '2026-12-01':{fase:'Lua Minguante', signo:'Virgem', icone:'ğŸŒ˜'},
  '2026-12-08':{fase:'Lua Nova', signo:'SagitÃ¡rio', icone:'ğŸŒ‘'},
  '2026-12-17':{fase:'Lua Crescente', signo:'Peixes', icone:'ğŸŒ’'},
  '2026-12-23':{fase:'Lua Cheia', signo:'GÃªmeos', icone:'ğŸŒ•'},
  '2026-12-30':{fase:'Lua Minguante', signo:'Libra', icone:'ğŸŒ˜'}
};
const sabas={
  '2026-02-01':{nome:'Lughnasadh',descricao:'Assar pÃ£es e bolos de grÃ£os, expressar gratidÃ£o pela fartura, agradecer pelos frutos colhidos e realizar ritual de colheita e prosperidade.'},
  '2026-03-20':{nome:'Mabon',descricao:'Oferendas de maÃ§Ã£s e frutas da estaÃ§Ã£o, partilha de banquetes, agradecimento pela colheita e rituais de equilÃ­brio e gratidÃ£o.'},
  '2026-05-01':{nome:'Samhain',descricao:'Honrar ancestrais, limpar altares, queimar pedidos ou banimentos, praticar divinaÃ§Ã£o e introspecÃ§Ã£o profunda.'},
  '2026-06-21':{nome:'Yule',descricao:'Acender a tora de Yule ou velas, decorar com sÃ­mbolos de vida eterna, celebrar o renascimento do sol e trocar presentes simbÃ³licos.'},
  '2026-08-01':{nome:'Imbolc',descricao:'Acender velas em honra a BrÃ­gida, realizar limpezas energÃ©ticas, rituais de purificaÃ§Ã£o, proteÃ§Ã£o e preparaÃ§Ã£o para a luz.'},
  '2026-09-22':{nome:'Ostara',descricao:'Plantio de sementes fÃ­sicas ou simbÃ³licas, decoraÃ§Ã£o de ovos, rituais de fertilidade, renovaÃ§Ã£o e equilÃ­brio.'},
  '2026-10-31':{nome:'Beltane',descricao:'DanÃ§ar ao redor do mastro de maio, acender fogueiras de proteÃ§Ã£o, celebrar amor, prazer, uniÃ£o e fertilidade.'},
  '2026-12-21':{nome:'Litha',descricao:'Rituais ao ar livre para absorver energia solar, colheita de ervas, fogueiras, mÃºsica, danÃ§a e honra ao Ã¡pice da luz.'}
};
const luaForaDeCurso={
  '2026-01-02':'09:23â€“10:09',
  '2026-02-05':'14:10â€“15:02',
  '2026-03-07':'22:40â€“23:30',
  '2026-04-11':'06:15â€“07:01',
  '2026-05-04':'18:50â€“19:44',
  '2026-06-09':'03:12â€“04:00',
  '2026-07-12':'11:30â€“12:18',
  '2026-08-06':'20:05â€“21:00',
  '2026-09-10':'08:44â€“09:33',
  '2026-10-08':'16:10â€“17:02',
  '2026-11-09':'01:22â€“02:10',
  '2026-12-07':'13:40â€“14:28'
};

function criarPlanner(){
  grid.innerHTML='';
  const total=new Date(anoAtual,mesAtual+1,0).getDate();
  const inicio=new Date(anoAtual,mesAtual,1).getDay();
  mesTitulo.textContent=new Date(anoAtual,mesAtual).toLocaleString('pt-BR',{month:'long',year:'numeric'});

  for(let i=0;i<inicio;i++){const v=document.createElement('div');v.style.visibility='hidden';grid.appendChild(v);}

  const notas=load('notas')||{};

  for(let d=1;d<=total;d++){
    const dataISO=`${anoAtual}-${String(mesAtual+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const el=document.createElement('div');el.className='dia';

    let icones='';
    if(lunacoes2026[dataISO]) icones+=lunacoes2026[dataISO].icone;
    if(sabas[dataISO]) icones+='ğŸ”¥';
    if(luaForaDeCurso[dataISO]) icones+='â³';

    el.innerHTML=`<strong>${d}</strong>`+(icones?`<div class="iconesTopo">${icones}</div>`:'');

    if(Array.isArray(notas[dataISO]) && notas[dataISO].length){
      el.innerHTML+=`<span class="estrela">âœ¶</span>`;
      const p=document.createElement('div');p.className='preview';p.textContent=notas[dataISO][notas[dataISO].length-1].texto;el.appendChild(p);
    }

    el.addEventListener('click',()=>abrirModal(dataISO,d));
    grid.appendChild(el);
  }
}

// ===== OrÃ¡culo diÃ¡rio =====
function avaliarDia(dataISO){
  const perfil=load('perfil')||{};
  const lua=lunacoes2026[dataISO];

  let linha1='';
  if(lua){
    linha1=`<strong>${lua.fase} em ${lua.signo}:</strong> ${significadoLua(lua.fase, lua.signo)}`;
  } else {
    linha1='<strong>Lua em trÃ¢nsito:</strong> continuidade do ciclo lunar em andamento.';
  }

  const numero=perfil.ano||'';
  const linha2=`<strong>Energia do dia:</strong> ${energiaDoDia(lua?.fase, numero, perfil.ciclo)}`;

  const linha3=`<strong>Ritual sugerido:</strong> ${ritualDoDia(lua?.fase, lua?.signo, dataISO)}`;

  return `${linha1}<br><br>${linha2}<br><br>${linha3}`;
}

function significadoLua(fase, signo){
  return `${fase.toLowerCase()} filtrada pela energia de ${signo}, ativando temas simbÃ³licos do signo.`;
}

function energiaDoDia(fase, numero, ciclo){
  let base=fase||'fluxo contÃ­nuo';
  let n=numero?` alinhado ao nÃºmero pessoal ${numero}`:'';
  let c=ciclo?' com influÃªncia corporal ativa':'';
  return `movimento interno guiado pela ${base}${n}${c}.`;
}

function ritualDoDia(fase, signo, dataISO){
  if(sabas[dataISO]){
    return `celebraÃ§Ã£o de ${sabas[dataISO].nome}: ${sabas[dataISO].descricao}`;
  }
  if(fase==='Lua Cheia') return 'ritual de gratidÃ£o, escrita consciente e celebraÃ§Ã£o simbÃ³lica.';
  if(fase==='Lua Nova') return 'plantio de intenÃ§Ãµes, silÃªncio ritual e visualizaÃ§Ã£o.';
  if(fase==='Lua Crescente') return 'aÃ§Ãµes progressivas, fortalecimento de hÃ¡bitos e foco.';
  if(fase==='Lua Minguante') return 'limpeza energÃ©tica, desapego e descanso consciente.';
  return 'prÃ¡tica simples de autocuidado e observaÃ§Ã£o.';
}

function abrirModal(dataISO,dia){
  diaAtual=dataISO;
  modalTitulo.textContent=`Dia ${dia}`;
  oraculo.innerHTML=avaliarDia(dataISO);
  notasSalvas.innerHTML='';
  const notas=load('notas')||{};
  if(Array.isArray(notas[dataISO])){
    notas[dataISO].forEach(n=>{const p=document.createElement('p');p.textContent=`${n.hora||''} â€” ${n.texto}`;notasSalvas.appendChild(p);});
  }
  modal.style.display='flex';
}

function fecharModal(){modal.style.display='none';notaTexto.value='';notaHora.value='';}

function salvarNota(){
  if(!notaTexto.value.trim()) return;
  const notas=load('notas')||{};
  if(!Array.isArray(notas[diaAtual])) notas[diaAtual]=[];
  notas[diaAtual].push({hora:notaHora.value,texto:notaTexto.value});
  save('notas',notas);
  fecharModal();criarPlanner();
}

salvar.onclick = () => {
  const perfil = {
    nome: nome.value,
    signo: signo.value,
    ano: anoPessoal.value,
    ciclo: ciclo.value
  };

  save('perfil', perfil);
  solicitarNotificacao(); // aqui estÃ¡ correto
  nomeCapa.textContent = `Salve, ${perfil.nome}`;

  overlay.style.display = 'none';
  capa.style.display = 'block';
};

irPlanner.onclick=()=>{capa.style.display='none';planner.style.display='block';const p=load('perfil');if(p)perfilEl.textContent=`${p.nome} Â· ${p.signo}`;criarPlanner();};
irProspera.onclick=()=>{capa.style.display='none';prospera.style.display='block'};
voltarCapa.onclick=()=>{planner.style.display='none';capa.style.display='block'};
voltarCapa2.onclick=()=>{prospera.style.display='none';capa.style.display='block'};

mesAnterior.onclick=()=>{mesAtual--;if(mesAtual<0){mesAtual=11;anoAtual--;}criarPlanner()};
mesProximo.onclick=()=>{mesAtual++;if(mesAtual>11){mesAtual=0;anoAtual++;}criarPlanner()};

btnFechar.onclick=fecharModal;
btnSalvarNota.onclick=salvarNota;

const salvo=load('perfil');
    if(salvo){overlay.style.display='none';
              capa.style.display='block';
              nomeCapa.textContent=`Salve, ${salvo.nome}`;
              
            // ===== Registro do PWA =====
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('ğŸŒ™ GrimÃ³rio instalado como PWA'))
      .catch(err => console.error('Erro no Service Worker', err));
  });


// ===== PermissÃ£o de notificaÃ§Ãµes =====
function solicitarNotificacao() {
  if (!('Notification' in window)) return;
  if (Notification.permission === 'default') {
    Notification.requestPermission();
  }
}
function salvarLembrete(lembrete){
  const lista = load('lembretes') || [];
  lista.push(lembrete);
  save('lembretes', lista);
}

}
// ===== BotÃ£o "Instalar GrimÃ³rio" =====
let deferredPrompt;

window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  const btn = document.getElementById('btnInstalar');
  if (btn) btn.style.display = 'block';
});

document.getElementById('btnInstalar')?.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
});

function verificarSabaHoje(){
  if(Notification.permission !== 'granted') return;

  const hoje = new Date().toISOString().split('T')[0];
  const saba = sabas[hoje];
  if(!saba) return;

  navigator.serviceWorker.ready.then(reg=>{
    reg.showNotification(`ğŸ”¥ Hoje Ã© ${saba.nome}`,{
      body: saba.descricao,
      icon: 'icon-192.png',
      tag: 'saba-hoje'
    });
  });
}
function agendarVerificacaoDiaria(){
  const agora = new Date();
  const proxima = new Date();

  proxima.setHours(8,0,0,0);
  if(agora > proxima) proxima.setDate(proxima.getDate()+1);

  const delay = proxima - agora;

  setTimeout(()=>{
    verificarSabaHoje();
    setInterval(verificarSabaHoje, 24*60*60*1000);
  }, delay);
}
agendarVerificacaoDiaria();
const salvo = load('perfil');
if(salvo){}
  overlay.style.display='none';
  capa.style.display='block';
  nomeCapa.textContent=`Salve, ${salvo.nome}`;
</script>
</body>
</html>
